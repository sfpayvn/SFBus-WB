<mat-dialog-title class="text-center">
  <span class="text-xl font-medium">{{ mode === 'create' ? 'Add' : 'Edit' }} Setting</span>
  <button class="absolute right-3" (click)="onCancel()">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
      <path
        fill-rule="evenodd"
        d="M5.47 5.47a.75.75 0 0 1 1.06 0L12 10.94l5.47-5.47a.75.75 0 1 1 1.06 1.06L13.06 12l5.47 5.47a.75.75 0 1 1-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 0 1-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 0 1 0-1.06Z"
        clip-rule="evenodd" />
    </svg>
  </button>
</mat-dialog-title>

<mat-dialog-content class="pb-5 pt-3">
  <form
    class="sm:min-w-36 md:min-w-96 mx-auto flex flex-col gap-1"
    [formGroup]="mainForm"
    nz-form
    (ngSubmit)="onSubmit()">
    <!-- Name -->
    <nz-form-item class="!w-full">
      <nz-form-label nzFor="name" [nzNoColon]="true" [nzRequired]="true" class="!flex !items-center !justify-start"
        >Name</nz-form-label
      >
      <nz-form-control [nzErrorTip]="nameErrorTpl" class="!flex flex-col">
        <nz-input-group [nzSuffix]="nameClearTpl" class="custom-nz-input-group !mt-0 !mb-0">
          <input type="text" nz-input formControlName="name" placeholder="Enter setting name" />
        </nz-input-group>
        <ng-template #nameClearTpl>
          @if(mainForm.get('name')?.value) {
          <span
            nz-icon
            class="ant-input-clear-icon"
            nzTheme="fill"
            nzType="close-circle"
            (click)="clearValue('name')"></span>
          }
        </ng-template>
        <ng-template #nameErrorTpl>
          <span class="mt-1 !text-xs text-red-500">
            @if (mainForm.get('name')?.errors?.['required']) { Name is required } @if
            (mainForm.get('name')?.errors?.['minlength']) { Name must be at least 2 characters }
          </span>
        </ng-template>
      </nz-form-control>
    </nz-form-item>

    <!-- Group Name -->
    <nz-form-item class="!w-full">
      <nz-form-label nzFor="groupName" [nzNoColon]="true" [nzRequired]="true" class="!flex !items-center !justify-start"
        >Group Name</nz-form-label
      >
      <nz-form-control [nzErrorTip]="groupNameErrorTpl" class="!flex flex-col">
        <nz-input-group [nzSuffix]="groupNameClearTpl" class="custom-nz-input-group !mt-0 !mb-0">
          <input type="text" nz-input formControlName="groupName" placeholder="Enter group name" />
        </nz-input-group>
        <ng-template #groupNameClearTpl>
          @if(mainForm.get('groupName')?.value) {
          <span
            nz-icon
            class="ant-input-clear-icon"
            nzTheme="fill"
            nzType="close-circle"
            (click)="clearValue('groupName')"></span>
          }
        </ng-template>
        <ng-template #groupNameErrorTpl>
          <span class="mt-1 !text-xs text-red-500">
            @if (mainForm.get('groupName')?.errors?.['required']) { Group Name is required }
          </span>
        </ng-template>
      </nz-form-control>
    </nz-form-item>

    <!-- Value -->
    <nz-form-item class="!w-full">
      <div class="!flex !items-center !justify-between gap-2">
        <nz-form-label nzFor="value" [nzNoColon]="true" [nzRequired]="true" class="!flex !items-start !justify-start"
          >Value</nz-form-label
        >
        <div class="flex gap-2">
          <button
            type="button"
            (click)="changeValueMode('editor')"
            [class.bg-primary]="valueEditorMode === 'editor'"
            [class.text-white]="valueEditorMode === 'editor'"
            class="hover:border-primary rounded border border-gray-300 px-2 py-1 text-xs">
            Editor
          </button>
          <button
            type="button"
            (click)="changeValueMode('json')"
            [class.bg-primary]="valueEditorMode === 'json'"
            [class.text-white]="valueEditorMode === 'json'"
            class="hover:border-primary rounded border border-gray-300 px-2 py-1 text-xs">
            JSON
          </button>
        </div>
      </div>
      <nz-form-control [nzErrorTip]="valueErrorTpl" class="!flex flex-col">
        @if(valueEditorMode === 'editor') {
        <quill-editor
          #quillEditorRef
          formControlName="value"
          [modules]="editorModules"
          placeholder="Enter formatted text..."
          class="w-full rounded border border-gray-300 bg-white">
        </quill-editor>
        } @else {
        <textarea
          formControlName="value"
          placeholder="Enter JSON"
          rows="6"
          class="w-full rounded border border-gray-300 p-2 font-mono text-sm"></textarea>
        }
        <ng-template #valueErrorTpl>
          <span class="mt-1 !text-xs text-red-500">
            @if (mainForm.get('value')?.errors?.['required']) { Value is required }
          </span>
        </ng-template>
      </nz-form-control>
    </nz-form-item>

    <!-- Description -->
    <nz-form-item class="!w-full">
      <nz-form-label nzFor="description" [nzNoColon]="true" class="!flex !items-start !justify-start"
        >Description</nz-form-label
      >
      <nz-form-control class="!flex flex-col">
        <nz-input-group [nzSuffix]="descriptionClearTpl" class="custom-nz-input-group !mt-0 !mb-0">
          <textarea
            nz-input
            formControlName="description"
            placeholder="Enter description (optional)"
            rows="3"
            class="rounded border border-gray-300 p-2"></textarea>
        </nz-input-group>
        <ng-template #descriptionClearTpl>
          @if(mainForm.get('description')?.value) {
          <span
            nz-icon
            class="ant-input-clear-icon"
            nzTheme="fill"
            nzType="close-circle"
            (click)="clearValue('description')"></span>
          }
        </ng-template>
      </nz-form-control>
    </nz-form-item>
  </form>
</mat-dialog-content>

<mat-dialog-actions class="flex justify-center gap-4 pb-5">
  <button
    class="!min-w-24 !bg-primary !flex !h-max !justify-center !rounded-lg !py-2 !px-3 !text-white hover:!border-red-500 hover:!bg-red-200 hover:!text-red-500"
    nz-button
    (click)="onSubmit()"
    type="button">
    {{ mode === 'create' ? 'CREATE' : 'UPDATE' }}
  </button>
  <button
    class="!min-w-24 !text-foreground hover:!text-foreground !flex !h-max !justify-center !rounded-lg border border-gray-300 !bg-gray-200 !px-3 !py-2 hover:!border-gray-300 hover:!bg-gray-300"
    nz-button
    (click)="onCancel()"
    type="button">
    CANCEL
  </button>
</mat-dialog-actions>
