<form class="my-10 space-y-6" [formGroup]="form" (ngSubmit)="onSubmit()">
  <div class="text-center">
    <h2 class="text-foreground mb-1 text-3xl font-semibold">Setup New Password</h2>
    <p class="text-muted-foreground text-sm">
      Have you already reset the password ? <a class="text-primary" routerLink="/auth/sign-in"> Sign in</a>
    </p>
  </div>

  <div class="space-y-3 text-left">
    <div class="relative flex flex-col gap-4">
      <nz-form-item class="!flex !w-full !flex-col">
        <nz-form-label nzFor="password" class="!flex !items-start !justify-start !p-0 !text-sm">Password</nz-form-label>
        <nz-form-control [nzErrorTip]="passwordErrorTpl" class="!contents">
          <nz-input-group [nzSuffix]="suffixTemplatePassword" class="!mt-0 !mb-0 !h-[36px] !rounded border-gray-200">
            <input
              [type]="passwordVisible ? 'text' : 'password'"
              nz-input
              placeholder="Nhập mật khẩu"
              formControlName="password"
              (focus)="passwordFocused = true"
              (blur)="passwordFocused = false" />
          </nz-input-group>
          <ng-template #suffixTemplatePassword>
            <div class="flex items-center gap-2">
              @if(f['password'].value){
              <span
                nz-icon
                class="ant-input-clear-icon"
                nzTheme="fill"
                nzType="close-circle"
                (click)="f['password'].patchValue('')"></span>
              }
              <svg-icon
                src="assets/icons/heroicons/outline/{{ passwordVisible ? 'eye-off' : 'eye' }}.svg"
                (click)="passwordVisible = !passwordVisible"
                [svgClass]="'h-5 w-5 cursor-pointer'">
              </svg-icon>
            </div>
          </ng-template>
          <ng-template #passwordErrorTpl let-control>
            <span class="mt-1 !text-xs text-red-500">
              @if (f['password'].errors?.['required'] && f['password'].touched) { Vui lòng nhập mật khẩu. } @if
              (f['password'].errors?.['passwordInvalid'] && f['password'].touched) { Vui lòng nhập đúng format mật khẩu.
              }
            </span>
          </ng-template>
        </nz-form-control>
      </nz-form-item>
      <div
        class="flex flex-col gap-2 overflow-hidden text-left transition-all duration-300 ease-in-out"
        [ngClass]="{
          'max-h-0 -translate-y-2 transform opacity-0': !passwordFocused,
          'max-h-96 translate-y-0 transform opacity-100': passwordFocused
        }">
        <label class="text-sm font-medium">Password yêu cầu</label>
        <label
          nz-checkbox
          [(ngModel)]="passwordConditions['minLength']"
          [ngModelOptions]="{ standalone: true }"
          class="nz-checkbox-marker pointer-events-none !m-0 !p-0 transition-all duration-200">
          Tối thiểu 8 ký tự
        </label>
        <label
          nz-checkbox
          [(ngModel)]="passwordConditions['hasWordCase']"
          [ngModelOptions]="{ standalone: true }"
          class="nz-checkbox-marker pointer-events-none !m-0 !p-0 transition-all duration-200">
          Ít nhất một chữ cái viết hoa và viết thường
        </label>
        <label
          nz-checkbox
          [(ngModel)]="passwordConditions['hasNumber']"
          [ngModelOptions]="{ standalone: true }"
          class="nz-checkbox-marker pointer-events-none !m-0 !p-0 transition-all duration-200">
          Ít nhất một chữ số
        </label>
        <label
          nz-checkbox
          [(ngModel)]="passwordConditions['hasSpecial']"
          [ngModelOptions]="{ standalone: true }"
          class="nz-checkbox-marker pointer-events-none !m-0 !p-0 transition-all duration-200">
          Ít nhất một ký tự đặc biệt: {{ '! @ # $ % ^ & * ( ) _ + - =' }}
        </label>
        <label
          nz-checkbox
          [(ngModel)]="passwordConditions['noneSpace']"
          [ngModelOptions]="{ standalone: true }"
          class="nz-checkbox-marker pointer-events-none !m-0 !p-0 transition-all duration-200">
          Không chứa khoảng trắng
        </label>
      </div>
    </div>
    <div class="relative">
      <nz-form-item class="!flex !w-full !flex-col">
        <nz-form-label nzFor="confirmPassword" class="!flex !items-start !justify-start !p-0 !text-sm"
          >Confirm Password</nz-form-label
        >
        <nz-form-control [nzErrorTip]="confirmPasswordErrorTpl" class="!contents">
          <nz-input-group
            [nzSuffix]="suffixTemplateConfirmPPassword"
            class="!mt-0 !mb-0 !h-[36px] !rounded border-gray-200">
            <input
              [type]="confirmPasswordVisible ? 'text' : 'password'"
              nz-input
              placeholder="Nhập lại mật khẩu"
              formControlName="confirmPassword" />
          </nz-input-group>
          <ng-template #suffixTemplateConfirmPPassword>
            <div class="flex items-center gap-2">
              @if(f['confirmPassword'].value){
              <span
                nz-icon
                class="ant-input-clear-icon"
                nzTheme="fill"
                nzType="close-circle"
                (click)="f['confirmPassword'].patchValue('')"></span>
              }
              <svg-icon
                src="assets/icons/heroicons/outline/{{ confirmPasswordVisible ? 'eye-off' : 'eye' }}.svg"
                (click)="confirmPasswordVisible = !confirmPasswordVisible"
                [svgClass]="'h-5 w-5 cursor-pointer'">
              </svg-icon>
            </div>
          </ng-template>
          <ng-template #confirmPasswordErrorTpl let-control>
            <span class="mt-1 !text-xs text-red-500">
              @if (f['confirmPassword'].errors?.['required'] && f['confirmPassword'].touched) { Vui lòng nhập mật khẩu.
              }
            </span>
          </ng-template>
          @if (f['confirmPassword'].errors?.['passwordMismatch'] && !f['confirmPassword'].errors?.['required'] &&
          f['confirmPassword'].touched) {
          <span class="mt-1 !text-xs text-red-500">Mật khẩu không khớp nhau.</span> }
        </nz-form-control>
      </nz-form-item>
    </div>
  </div>

  <!-- Submit Button -->
  <div>
    <app-button full impact="bold" tone="primary" shape="rounded" size="medium"> Submit </app-button>
  </div>
</form>
