<div class="rounded-lg bg-white p-4 shadow-sm">
  <h2 class="mb-4 text-lg font-semibold text-gray-800">Hàng hóa gần đây</h2>
  <div class="overflow-x-auto">
    <nz-table
      #rowSelectionTable
      nzShowPagination
      nzShowSizeChanger
      [nzFrontPagination]="false"
      [nzData]="goodsList"
      [nzLoading]="!isLoaded"
      class="!w-full">
      <thead>
        <tr>
          <th class="min-w-[30px]"></th>
          <th class="min-w-[60px]">#</th>
          <th class="min-w-[150px]">Tên hàng</th>
          <th class="min-w-[80px]">Số lượng</th>
          <th class="min-w-[100px]">Phí ship</th>
          <th class="min-w-[80px]">Trạng thái</th>
          <th class="min-w-[80px]">Thời gian tạo</th>
          <th class="min-w-[80px] !text-right">Actions</th>
        </tr>
      </thead>
      <tbody>
        @for (goods of rowSelectionTable.data; track goods) {
        <tr [class.bg-gray-50]="isExpanded(goods._id)">
          <td class="!py-2">
            <button
              (click)="toggleExpand(goods._id)"
              class="hover:text-primary text-gray-600 transition-all duration-200"
              [attr.aria-expanded]="isExpanded(goods._id)">
              <svg-icon
                [src]="
                  isExpanded(goods._id)
                    ? 'assets/icons/heroicons/outline/chevron-down.svg'
                    : 'assets/icons/heroicons/outline/chevron-right.svg'
                "
                [svgClass]="'h-6 w-6'"></svg-icon>
            </button>
          </td>
          <td>
            <nz-skeleton [nzLoading]="!isLoaded" [nzParagraph]="false" [nzTitle]="{ width: '100%' }" [nzActive]="true">
              {{ goods.goodsNumber }}
            </nz-skeleton>
          </td>
          <td>
            <nz-skeleton [nzLoading]="!isLoaded" [nzParagraph]="false" [nzTitle]="{ width: '100%' }" [nzActive]="true">
              {{ goods.name }}
            </nz-skeleton>
          </td>
          <td>
            <nz-skeleton [nzLoading]="!isLoaded" [nzParagraph]="false" [nzTitle]="{ width: '100%' }" [nzActive]="true">
              {{ goods.quantity }}
            </nz-skeleton>
          </td>
          <td>
            <nz-skeleton [nzLoading]="!isLoaded" [nzParagraph]="false" [nzTitle]="{ width: '100%' }" [nzActive]="true">
              {{ utils.formatPriceToVND(goods.shippingCost) }}
            </nz-skeleton>
          </td>
          <td>
            <nz-skeleton [nzLoading]="!isLoaded" [nzParagraph]="false" [nzTitle]="{ width: '100%' }" [nzActive]="true">
              <span class="p-2 uppercase rounded-md text-xs {{ getGoodsStatusClass(goods.status) }}">
                {{ getGoodsStatusLabel(goods.status) }}
              </span>
            </nz-skeleton>
          </td>
          <td>
            <nz-skeleton [nzLoading]="!isLoaded" [nzParagraph]="false" [nzTitle]="{ width: '100%' }" [nzActive]="true">
              {{ goods.createdAt | date: 'short' }}
            </nz-skeleton>
          </td>
          <td class="text-right">
            <nz-skeleton [nzLoading]="!isLoaded" [nzParagraph]="false" [nzTitle]="{ width: '100%' }" [nzActive]="true">
              <button
                (click)="viewDetailGoods(goods)"
                class="text-muted-foreground hover:bg-card hover:text-foreground inline-flex h-7 w-7 cursor-pointer items-center justify-center rounded-md"
                aria-label="Edit goods">
                <svg viewBox="0 0 20 20" fill="currentColor" class="size-5">
                  <path
                    d="m2.695 14.762-1.262 3.155a.5.5 0 0 0 .65.65l3.155-1.262a4 4 0 0 0 1.343-.886L17.5 5.501a2.121 2.121 0 0 0-3-3L3.58 13.419a4 4 0 0 0-.885 1.343Z" />
                </svg>
              </button>
            </nz-skeleton>
          </td>
        </tr>
        <!-- Expandable Row with goods details -->
        <tr>
          <td colspan="10" class="!border-0 !p-0">
            <nz-collapse [nzBordered]="false" [nzGhost]="true">
              <nz-collapse-panel [nzActive]="isExpanded(goods._id)" [nzShowArrow]="false" [nzDisabled]="true">
                <div class="flex flex-col gap-2">
                  <label class="text-sm font-semibold text-gray-700">Thông tin chi tiết:</label>
                  <div class="rounded-lg border border-purple-200 bg-purple-50 p-3">
                    <div class="grid grid-cols-2 gap-3 text-sm">
                      <div>
                        <label class="font-medium text-gray-600">Người Gửi</label>
                        <span class="ml-2 text-gray-700">{{ goods.senderName }} - {{ goods.senderPhoneNumber }}</span>
                      </div>
                      <div>
                        <label class="font-medium text-gray-600">Người Nhận</label>
                        <span class="ml-2 text-gray-700"
                          >{{ goods.customerName }} - {{ goods.customerPhoneNumber }}</span
                        >
                      </div>
                      <div>
                        <label class="font-medium text-gray-600">Địa chỉ người gửi:</label>
                        <span class="ml-2 text-gray-700">{{ goods.pickupAddress || 'Chưa có thông tin' }}</span>
                      </div>
                      <div>
                        <label class="font-medium text-gray-600">Địa chỉ người nhận:</label>
                        <span class="ml-2 text-gray-700">{{ goods.deliveryAddress || 'Chưa có thông tin' }}</span>
                      </div>
                      <div>
                        <label class="font-medium text-gray-600">Giá trị hàng:</label>
                        <span class="ml-2 text-gray-700">{{ utils.formatPriceToVND(goods.goodsValue || 0) }}</span>
                      </div>
                      <div>
                        <label class="font-medium text-gray-600">COD:</label>
                        <span class="ml-2 text-gray-700">{{ utils.formatPriceToVND(goods.cod || 0) }}</span>
                      </div>
                      <div>
                        <label class="font-medium text-gray-600">Khối lượng:</label>
                        <span class="ml-2 text-gray-700">{{ goods.weight }} kg</span>
                      </div>
                      <div>
                        <label class="font-medium text-gray-600">Kích thước (DxRxC):</label>
                        <span class="ml-2 text-gray-700"
                          >{{ goods.length }} x {{ goods.width }} x {{ goods.height }} cm</span
                        >
                      </div>
                      @if (goods.categoriesIds && goods.categoriesIds.length > 0) {
                      <div class="col-span-2">
                        <label class="font-medium text-gray-600">Loại hàng:</label>
                        <div class="mt-1 flex flex-wrap gap-2">
                          @for (categoryId of goods.categoriesIds; track $index) {
                          <span class="rounded bg-purple-500 px-2 py-1 text-xs font-semibold text-white">
                            {{ getCategoryById(categoryId)?.name || 'N/A' }}
                          </span>
                          }
                        </div>
                      </div>
                      } @if (goods.note) {
                      <div class="col-span-2">
                        <label class="font-medium text-gray-600">Ghi chú:</label>
                        <span class="ml-2 text-gray-700">{{ goods.note }}</span>
                      </div>
                      }
                    </div>
                  </div>
                </div>
              </nz-collapse-panel>
            </nz-collapse>
          </td>
        </tr>
        }
      </tbody>
    </nz-table>
  </div>
</div>
