@if (busScheduleSearchForm) {
<form nz-form [formGroup]="busScheduleSearchForm" (ngSubmit)="onSubmit()">
  <div class="flex flex-col gap-4 pb-4">
    <div class="flex items-center justify-end gap-2" (click)="resetFilter()">
      <label class="text-primary cursor-pointer font-semibold">Bỏ lọc</label>
      <ion-icon class="text-primary cursor-pointer font-semibold" name="refresh-outline"></ion-icon>
    </div>
    <div class="flex w-full flex-col">
      <nz-form-item class="!mb-0 !w-full !flex-col">
        <nz-form-label nzFor="busRouteId" class="!m-0 !flex !items-center !justify-start !p-0 !text-base !font-semibold"
          >Tuyến xe</nz-form-label
        >
        <nz-form-control>
          <nz-select
            class="custom-nz-select height-large !mt-0 !mb-0 !h-[42px]"
            formControlName="busRouteId"
            nzPlaceHolder="Chọn tuyến xe"
            (ngModelChange)="chooseBusRoute()"
            [nzAllowClear]="true">
            @for (busRoute of busRoutes; track busRoute) {
            <nz-option nzCustomContent [nzLabel]="busRoute.name" [nzValue]="busRoute._id">
              <div class="flex items-center">
                <span class="!font-medium">
                  {{ busRoute.name }}
                </span>
              </div>
            </nz-option>
            }
          </nz-select>
        </nz-form-control>
      </nz-form-item>
    </div>
    <div class="flex w-full flex-col">
      <nz-form-item class="!mb-0 !w-full !flex-col">
        <nz-form-label
          nzFor="timeSchedule"
          class="!m-0 !flex !items-center !justify-start !p-0 !text-base !font-semibold"
          >Thời gian</nz-form-label
        >
        <div class="flex w-full flex-row gap-2">
          <nz-date-picker
            [nzDisabledDate]="checkDisableDateTime(0)"
            [nzDisabledTime]="checkDisableDateTime(0).nzDisabledTime"
            nzShowTime
            nzFormat="yyyy-MM-dd HH:mm"
            [nzMode]="'date'"
            formControlName="startTimeScheduleValue"
            nzPlaceHolder="Start"
            class="w-full"
            (ngModelChange)="timeScheduleChange($event)"
            (nzOnOpenChange)="handleStartOpenChange($event)"></nz-date-picker>
          <nz-date-picker
            #endDatePicker
            [nzDisabledDate]="checkDisableDateTime(1)"
            [nzDisabledTime]="checkDisableDateTime(1).nzDisabledTime"
            nzShowTime
            nzFormat="yyyy-MM-dd HH:mm"
            [nzMode]="'date'"
            formControlName="endTimeScheduleValue"
            nzPlaceHolder="End"
            class="w-full"
            (ngModelChange)="timeScheduleChange($event)"
            (nzOnOpenChange)="handleEndOpenChange($event)"></nz-date-picker>
        </div>
      </nz-form-item>
    </div>
    <div class="flex w-full flex-col">
      <nz-form-item class="!mb-0 !w-full !flex-col">
        <nz-form-label
          nzFor="busScheduleId"
          class="!m-0 !flex !items-center !justify-start !p-0 !text-base !font-semibold"
          >Chuyến xe</nz-form-label
        >
        <nz-form-control>
          <nz-select
            class="custom-nz-select custom-nz-select-2-line height-large !mt-0 !mb-0"
            formControlName="busScheduleId"
            nzPlaceHolder="Chọn Bus Schedule"
            nzSize="large"
            nzShowSearch
            nzServerSearch
            nzAllowClear
            (nzOnSearch)="onSearch($event)"
            [nzOptionHeightPx]="80"
            (ngModelChange)="chooseBusSchedule($event)"
            [nzCustomTemplate]="defaultTemplateSelectBusSchedule">
            @for (busSchedule of busSchedulesFiltered; track busSchedule) {
            <nz-option nzCustomContent [nzLabel]="busSchedule.name" [nzValue]="busSchedule._id">
              <div class="flex flex-col">
                <span class="flex w-full justify-between">
                  <span>
                    {{ busSchedule.bus?.name || 'Chưa có xe' }}
                  </span>
                  <span> {{ formatTime(busSchedule.startDate) }} - {{ formatDate(busSchedule.startDate) }} </span>
                </span>
                <span class="flex w-full justify-end">
                  <span> {{ formatTime(busSchedule.endDate) }} - {{ formatDate(busSchedule.endDate) }} </span>
                </span>
              </div>
            </nz-option>
            }
          </nz-select>
          <ng-template #defaultTemplateSelectBusSchedule let-selected>
            @if (busSchedule) {
            <div class="flex flex-col">
              <span class="flex w-full justify-between leading-[26px]">
                <span>
                  {{ busSchedule.bus?.name || 'Chưa có xe' }}
                </span>
                <span> {{ formatTime(busSchedule.startDate) }} - {{ formatDate(busSchedule.startDate) }} </span>
              </span>
              <span class="flex w-full justify-end leading-[26px]">
                <span> {{ formatTime(busSchedule.endDate) }} - {{ formatDate(busSchedule.endDate) }} </span>
              </span>
            </div>
            }
          </ng-template>
        </nz-form-control>
      </nz-form-item>
    </div>
    <div class="flex w-full justify-end">
      <button
        class="!min-w-24 !bg-primary !flex !h-max cursor-pointer !justify-center !rounded !py-2 !px-3 !text-white hover:!border-red-500 hover:!bg-red-200 hover:!text-red-500"
        nz-button
        nzType="default"
        type="submit">
        OK
      </button>
    </div>
  </div>
</form>
}
