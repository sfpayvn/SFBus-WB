<div class="w-full rounded-md bg-white py-6">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <!-- Header Section -->
    <div class="mb-6 flex items-center justify-between">
      <div>
        <h1 class="text-3xl font-bold text-gray-900">Notification Schedule</h1>
        <p class="mt-2 text-gray-600">Manage and schedule your notifications</p>
      </div>
      <button
        class="inline-flex items-center gap-2 rounded-lg bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition-colors hover:bg-indigo-700"
        capCheck
        [capModule]="moduleKeys.NOTIFICATION_SCHEDULE"
        [capFunction]="functionKeys.NOTIFICATION_SCHEDULE.CREATE"
        (click)="goToScheduleDetail(null)">
        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
        </svg>
        New Schedule
      </button>
    </div>

    <!-- View Toggle -->
    <div class="mb-6 flex gap-3">
      <button
        (click)="viewMode = 'calendar'"
        [ngClass]="{
          'bg-white text-indigo-600 shadow-sm': viewMode === 'calendar',
          'bg-gray-100 text-gray-700': viewMode !== 'calendar'
        }"
        class="rounded-lg px-4 py-2 text-sm font-medium transition-colors">
        Calendar View
      </button>
      <button
        (click)="viewMode = 'table'"
        [ngClass]="{
          'bg-white text-indigo-600 shadow-sm': viewMode === 'table',
          'bg-gray-100 text-gray-700': viewMode !== 'table'
        }"
        class="rounded-lg px-4 py-2 text-sm font-medium transition-colors">
        Table View
      </button>
    </div>

    <!-- Calendar View -->
    <div *ngIf="viewMode === 'calendar'" class="mb-6">
      <app-calendar-events
        [events]="convertToCalendarEventData(notificationSchedule)"
        [isLoadedEvent]="!isLoadingSchedules"
        [isCloneEvent]="true"
        capCheck
        [capModule]="moduleKeys.NOTIFICATION_SCHEDULE"
        [capFunction]="functionKeys.NOTIFICATION_SCHEDULE.CREATE"
        (viewDetailEventEmit)="editNotificationSchedule($event)"
        (cloneDataEventEmit)="cloneData($event)"
        (createEventEmit)="addNotificationSchedule($event)"
        (reLoadEventEmit)="reLoadDataEvent($event)"></app-calendar-events>
    </div>

    <!-- Table View -->
    <div *ngIf="viewMode === 'table'" class="overflow-hidden rounded-lg border border-gray-200 bg-white shadow-sm">
      <nz-spin nzTip="Loading schedules..." [nzSpinning]="isLoadingSchedules">
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead class="border-b border-gray-200 bg-gray-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-700">Title</th>
                <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-700">Status</th>
                <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-700">
                  Scheduled Date
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-700">
                  Recipients
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-700">Sent</th>
                <th class="px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-700">Actions</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
              <tr
                *ngFor="let schedule of notificationSchedule; trackBy: trackBySchedule"
                class="transition-colors hover:bg-gray-50">
                <td class="px-6 py-4 text-sm font-medium text-gray-900">
                  <div>{{ schedule.title }}</div>
                  <div class="mt-1 text-xs text-gray-500">{{ schedule.description }}</div>
                </td>
                <td class="px-6 py-4 text-sm">
                  <span
                    [ngClass]="getStatusBadgeClass(schedule.status)"
                    class="inline-flex rounded-full px-3 py-1 text-xs font-semibold">
                    {{ getStatusLabel(schedule.status) }}
                  </span>
                </td>
                <td class="px-6 py-4 text-sm text-gray-600">
                  {{ schedule.scheduledDate | date: 'MMM dd, yyyy HH:mm' }}
                </td>
                <td class="px-6 py-4 text-sm text-gray-600">
                  {{ schedule.recipients.length }}
                </td>
                <td class="px-6 py-4 text-sm">
                  <div class="flex gap-2">
                    <span class="inline-flex rounded bg-green-100 px-2 py-1 text-xs font-medium text-green-800">
                      {{ schedule.sentCount }}
                    </span>
                    <span
                      *ngIf="schedule.failedCount > 0"
                      class="inline-flex rounded bg-red-100 px-2 py-1 text-xs font-medium text-red-800">
                      {{ schedule.failedCount }} failed
                    </span>
                  </div>
                </td>
                <td class="px-6 py-4 text-right text-sm">
                  <div class="flex justify-end gap-2">
                    <button
                      class="text-xs font-medium text-indigo-600 hover:text-indigo-900"
                      (click)="onViewDetailEvent(schedule)">
                      Edit
                    </button>
                    <button
                      *ngIf="schedule.status === 'scheduled'"
                      class="text-xs font-medium text-blue-600 hover:text-blue-900"
                      (click)="sendNow(schedule)">
                      Send Now
                    </button>
                    <button
                      *ngIf="schedule.status === 'scheduled' || schedule.status === 'draft'"
                      class="text-xs font-medium text-yellow-600 hover:text-yellow-900"
                      (click)="cancelSchedule(schedule)">
                      Cancel
                    </button>
                    <button
                      class="text-xs font-medium text-red-600 hover:text-red-900"
                      (click)="deleteSchedule(schedule)">
                      Delete
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div *ngIf="notificationSchedule.length === 0 && !isLoadingSchedules" class="p-8 text-center">
          <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
          </svg>
          <h3 class="mt-2 text-sm font-medium text-gray-900">No schedules</h3>
          <p class="mt-1 text-sm text-gray-500">Get started by creating a new notification schedule.</p>
        </div>
      </nz-spin>
    </div>
  </div>
</div>
