<div class="w-[1128px] mx-auto py-6">
  <div class="mb-4 flex justify-end">
    <div class="inline-block space-x-4">
      <button class="bg-muted text-muted-foreground hover:text-foreground rounded-md px-4 py-2.5 text-xs font-semibold"
        (click)="backPage()">
        Back
      </button>
    </div>
  </div>
  <div class="border-muted/20 bg-white flex min-w-full flex-col rounded-xl border p-2">
    <div class="p-2 flex justify-center">
      <label class="text-xl font-semibold">
        <span *ngIf="mode == 'update'">
          Sửa Hàng hóa
        </span>
        <span *ngIf="mode == 'create'">
          Thêm Hàng hóa
        </span>
      </label>
    </div>
    <div class="border-muted/20 bg-background flex min-w-full flex-col rounded-xl border px-6 py-2">
      <form [formGroup]="mainForm" nz-form *ngIf="mainForm" (ngSubmit)="onSubmit()">
        <div class="flex gap-4">
          <div class="flex h-full w-4/12 flex-col">
            <nz-form-label [nzNoColon]="true" nzFor="image"
              class="!flex !items-center !justify-start !font-medium">Image</nz-form-label>
            <div class="flex h-full w-full flex-col items-center justify-center gap-2">
              <div
                class="flex h-28 w-32 items-center justify-center overflow-hidden rounded-sm border border-dashed border-blue-500">
                <img alt="goods avatar" [src]="goodsImage || defaultImage" [class]="'w-full cursor-pointer'" />
              </div>
              <button
                class="!min-w-24 !flex !h-max !justify-center !rounded-lg !py-2 !px-3 hover:!border-red-500 hover:!bg-red-200 hover:!text-red-500"
                nz-button type="button" nzType="default">
                <span>Chụp ảnh</span>
              </button>
            </div>
          </div>
          <div class="flex w-8/12 flex-wrap">
            <div class="flex w-full gap-4 p-2" *ngIf="goods">
              <div class="block w-6/12">
                <nz-form-label [nzNoColon]="true" nzFor="goodsNumber"
                  class="!flex !items-center !justify-start !font-medium">Mã Hàng Hóa</nz-form-label>
                <div>
                  # {{goods.goodsNumber}}
                </div>
              </div>
              <div class="block w-6/12">
                <nz-form-label [nzNoColon]="true" nzFor="status"
                  class="!flex !items-center !justify-start !font-medium">Tình Trạng Hàng Hóa</nz-form-label>
                <nz-form-control class="!flex flex-col !max-h-[42px]">
                  <nz-select class="custom-nz-select custom-nz-select-goods-status height-large !mt-0 !mb-0 !h-[42px] !w-full custom-nz-select-goods-status-{{
                      mainForm.get('status')?.value
                  }}" formControlName="status">
                    @for (goodsStatus of goodsStatuses; track goodsStatus) {
                    <nz-option [nzLabel]="goodsStatus.label" [nzValue]="goodsStatus.value"></nz-option>
                    }
                  </nz-select>
                </nz-form-control>
              </div>
            </div>
            <div class="flex w-full gap-4 p-2">
              <div class="block w-6/12">
                <nz-form-label [nzNoColon]="true" nzFor="customerPhoneNumber"
                  class="!flex !items-center !justify-start !font-medium">Customer Phone
                  Number</nz-form-label>
                <nz-form-control [nzErrorTip]="goodsFormcustomerPhoneNumberErrorTpl" class="!flex flex-col">
                  <nz-input-group [nzSuffix]="goodsFormcustomerPhoneNumberClearTpl"
                    class="custom-nz-input-group !mt-0 !mb-0 !rounded border-gray-200">
                    <input type="text" nz-input formControlName="customerPhoneNumber" mask="0000 000 000"
                      placeholder="Nhập Customer Phone Number" />
                  </nz-input-group>
                  <ng-template #goodsFormcustomerPhoneNumberClearTpl>
                    <span nz-icon class="ant-input-clear-icon" nzTheme="fill" nzType="close-circle"
                      (click)="mainForm.controls['customerPhoneNumber'].patchValue('')"></span>
                  </ng-template>
                  <ng-template #goodsFormcustomerPhoneNumberErrorTpl let-control>
                    <span class="mt-1 !text-xs text-red-500">
                      @if (mainForm.controls['customerPhoneNumber'].errors?.['required']) { Vui lòng nhập số điện thoại
                      }
                      @if(mainForm.controls['customerPhoneNumber'].errors?.['pattern']) { Vui lòng nhập đúng số điện
                      thoại }
                    </span>
                  </ng-template>
                </nz-form-control>
              </div>
              <div class="block w-6/12">
                <nz-form-label [nzNoColon]="true" nzFor="customerName"
                  class="!flex !items-center !justify-start !font-medium">Customer Name</nz-form-label>
                <nz-form-control [nzErrorTip]="goodsFormcustomerNameErrorTpl" class="!flex flex-col">
                  <nz-input-group [nzSuffix]="goodsFormcustomerNameClearTpl"
                    class="custom-nz-input-group !mt-0 !mb-0 !rounded border-gray-200">
                    <input type="text" nz-input formControlName="customerName" placeholder="Nhập Customer Nam" />
                  </nz-input-group>
                  <ng-template #goodsFormcustomerNameClearTpl>
                    <span nz-icon class="ant-input-clear-icon" nzTheme="fill" nzType="close-circle"
                      (click)="mainForm.controls['customerName'].patchValue('')"></span>
                  </ng-template>
                  <ng-template #goodsFormcustomerNameErrorTpl let-control>
                    <span class="mt-1 !text-xs text-red-500">
                      @if (mainForm.controls['customerName'].errors?.['required']) { Vui lòng nhập trường này }
                    </span>
                  </ng-template>
                </nz-form-control>
              </div>
            </div>
            <div class="flex w-full gap-4 p-2">
              <div class="block w-full">
                <nz-form-label [nzNoColon]="true" nzFor="customerAddress"
                  class="!flex  !items-center !justify-start !font-medium">Customer Address</nz-form-label>
                <nz-input-group [nzSuffix]="goodsFormcustomerAddressClearTpl"
                  class="!mt-0 !mb-0 custom-nz-textarea-group !rounded border-gray-200">
                  <textarea nz-input formControlName="customerAddress" placeholder="Nhập Customer Address"></textarea>
                </nz-input-group>
                <ng-template #goodsFormcustomerAddressClearTpl>
                  <span nz-icon class="ant-input-clear-icon" nzTheme="fill" nzType="close-circle"
                    (click)="mainForm.controls['customerAddress'].patchValue('')"></span>
                </ng-template>
              </div>
            </div>
            <div class="flex w-full gap-4 p-2">
              <div class="block w-5/12">
                <nz-form-label [nzNoColon]="true" nzFor="name"
                  class="!flex !items-center !justify-start !font-medium">Name</nz-form-label>
                <nz-form-control [nzErrorTip]="goodsFormNameErrorTpl" class="!flex flex-col">
                  <nz-input-group [nzSuffix]="goodsFormNameClearTpl"
                    class="custom-nz-input-group !mt-0 !mb-0 !rounded border-gray-200">
                    <input type="text" nz-input formControlName="name" placeholder="Nhập Name" />
                  </nz-input-group>
                  <ng-template #goodsFormNameClearTpl>
                    <span nz-icon class="ant-input-clear-icon" nzTheme="fill" nzType="close-circle"
                      (click)="mainForm.controls['name'].patchValue('')"></span>
                  </ng-template>
                  <ng-template #goodsFormNameErrorTpl let-control>
                    <span class="mt-1 !text-xs text-red-500">
                      @if (mainForm.controls['name'].errors?.['required']) { Vui lòng nhập trường này }
                    </span>
                  </ng-template>
                </nz-form-control>
              </div>
              <div class="block w-2/12">
                <nz-form-label [nzNoColon]="true" nzFor="quantity"
                  class="!flex !items-center !justify-start !font-medium">Quantity</nz-form-label>
                <nz-form-control [nzErrorTip]="goodsFormQuantityErrorTpl" class="!flex flex-col">
                  <nz-input-group [nzSuffix]="goodsFormQuantityClearTpl"
                    class="custom-nz-input-group !mt-0 !mb-0 !rounded border-gray-200">
                    <input type="number" nz-input formControlName="quantity" placeholder="Nhập Quantity" />
                  </nz-input-group>
                  <ng-template #goodsFormQuantityClearTpl>
                    <span nz-icon class="ant-input-clear-icon" nzTheme="fill" nzType="close-circle"
                      (click)="mainForm.controls['quantity'].patchValue('')"></span>
                  </ng-template>
                  <ng-template #goodsFormQuantityErrorTpl let-control>
                    <span class="mt-1 !text-xs text-red-500">
                      @if (mainForm.controls['quantity'].errors?.['required']) { Vui lòng nhập trường này }
                    </span>
                  </ng-template>
                </nz-form-control>
              </div>
              <div class="block w-5/12">
                <nz-form-label [nzNoColon]="true" nzFor="quantity"
                  class="!flex !items-center !justify-start !font-medium">Phân loại</nz-form-label>
                <nz-form-control>
                  <nz-select class="custom-nz-select height-large !mt-0 !mb-0 " formControlName="categories"
                    nzPlaceHolder="Chọn Phân loại" nzSize="large" [nzOptionHeightPx]="80" nzMode="multiple"
                    [nzCustomTemplate]="defaultTemplateSelectGoodsCategory">
                    @for (goodsCategory of goodsCategories; track goodsCategory) {
                    <nz-option nzCustomContent [nzLabel]="goodsCategory.name" [nzValue]="goodsCategory._id">
                      <div class="flex items-center gap-2">
                        <svg-icon [src]="goodsCategory.icon" [svgClass]="'w-6 h-6'"></svg-icon>
                        <span>{{ goodsCategory.name }}</span>
                      </div>
                    </nz-option>
                    }
                  </nz-select>
                  <ng-template #defaultTemplateSelectGoodsCategory let-selected>
                    <div class="flex items-center gap-2" *ngIf="goodsCategory">
                      <svg-icon [src]="goodsCategory.icon" [svgClass]="'w-6 h-6'" ></svg-icon>
                      <span>{{ goodsCategory.name }}</span>
                    </div>
                  </ng-template>
                </nz-form-control>
              </div>
            </div>
            <div class="flex w-full gap-4 p-2">
              <div class="block w-4/12">
                <nz-form-label [nzNoColon]="true" nzFor="shoppingCost"
                  class="!flex !items-center !justify-start !font-medium">Phí vận chuyển</nz-form-label>
                <nz-form-control [nzErrorTip]="goodsFormShoppingCostErrorTpl" class="!flex flex-col">
                  <nz-input-group [nzSuffix]="goodsFormShoppingCostClearTpl"
                    class="custom-nz-input-group !mt-0 !mb-0 !rounded border-gray-200">
                    <input type="text" nz-input formControlName="shoppingCost" placeholder="Nhập số tiền"
                      mask="separator.0" prefix="₫ " thousandSeparator="," />
                  </nz-input-group>
                  <ng-template #goodsFormShoppingCostClearTpl>
                    <span nz-icon class="ant-input-clear-icon" nzTheme="fill" nzType="close-circle"
                      (click)="mainForm.controls['shoppingCost'].patchValue('')"></span>
                  </ng-template>
                  <ng-template #goodsFormShoppingCostErrorTpl let-control>
                    <span class="mt-1 !text-xs text-red-500">
                      @if (mainForm.controls['shoppingCost'].errors?.['required']) { Vui lòng nhập trường này }
                    </span>
                  </ng-template>
                </nz-form-control>
              </div>
              <div class="block w-4/12">
                <nz-form-label [nzNoColon]="true" nzFor="cod"
                  class="!flex !items-center !justify-start !font-medium">COD</nz-form-label>
                <nz-form-control [nzErrorTip]="goodsFormCodErrorTpl" class="!flex flex-col">
                  <nz-input-group [nzSuffix]="goodsFormCodClearTpl"
                    class="custom-nz-input-group !mt-0 !mb-0 !rounded border-gray-200">
                    <input type="text" nz-input formControlName="cod" placeholder="Nhập số tiền" mask="separator.0"
                      prefix="₫ " thousandSeparator="," />
                  </nz-input-group>
                  <ng-template #goodsFormCodClearTpl>
                    <span nz-icon class="ant-input-clear-icon" nzTheme="fill" nzType="close-circle"
                      (click)="mainForm.controls['cod'].patchValue('')"></span>
                  </ng-template>
                  <ng-template #goodsFormCodErrorTpl let-control>
                    <span class="mt-1 !text-xs text-red-500">
                      @if (mainForm.controls['cod'].errors?.['required']) { Vui lòng nhập trường này }
                    </span>
                  </ng-template>
                </nz-form-control>
              </div>
              <div class="block w-4/12">
                <nz-form-label [nzNoColon]="true" nzFor="goodsValue"
                  class="!flex !items-center !justify-start !font-medium">Giá trị hàng hóa</nz-form-label>
                <nz-form-control [nzErrorTip]="goodsFormGoodsValueErrorTpl" class="!flex flex-col">
                  <nz-input-group [nzSuffix]="goodsFormGoodsValueClearTpl"
                    class="custom-nz-input-group !mt-0 !mb-0 !rounded border-gray-200">
                    <input type="text" nz-input formControlName="goodsValue" placeholder="Nhập số tiền"
                      mask="separator.0" prefix="₫ " thousandSeparator="," />
                  </nz-input-group>
                  <ng-template #goodsFormGoodsValueClearTpl>
                    <span nz-icon class="ant-input-clear-icon" nzTheme="fill" nzType="close-circle"
                      (click)="mainForm.controls['goodsValue'].patchValue('')"></span>
                  </ng-template>
                  <ng-template #goodsFormGoodsValueErrorTpl let-control>
                    <span class="mt-1 !text-xs text-red-500">
                      @if (mainForm.controls['goodsValue'].errors?.['required']) { Vui lòng nhập trường này }
                    </span>
                  </ng-template>
                </nz-form-control>
              </div>
            </div>
            <div class="flex w-full gap-4 p-2">
              <div class="block w-6/12">
                <nz-form-label nzFor="busScheduleId" class="!flex !items-center !justify-start !font-medium">Bus
                  Route</nz-form-label>
                <nz-form-control [nzErrorTip]="goodsFormBusRouteIdErrorTpl">
                  <nz-select class="custom-nz-select height-large !mt-0 !mb-0 !h-[42px]" formControlName="busRouteId"
                    nzPlaceHolder="Chọn Bus Route" nzSize="large" [nzOptionHeightPx]="80"
                    (ngModelChange)="filterBusSchedulesByRoute($event)">
                    @for (busRoute of busRoutes; track busRoute) {
                    <nz-option nzCustomContent [nzLabel]="busRoute.name" [nzValue]="busRoute._id">
                      <div class="flex flex-col">
                        <span>{{ busRoute.name }}</span>
                      </div>
                    </nz-option>
                    }
                  </nz-select>
                  <ng-template #goodsFormBusRouteIdErrorTpl let-control>
                    <span class="mt-1 !text-xs text-red-500">
                      @if (mainForm.controls['busRouteId'].errors?.['required']) { Vui lòng nhập trường này }
                    </span>
                  </ng-template>
                </nz-form-control>
              </div>
              <div class="block w-6/12">
                <nz-form-label nzFor="busScheduleId" class="!flex !items-center !justify-start !font-medium">Bus
                  Schedule</nz-form-label>
                <nz-form-control>
                  <nz-select class="custom-nz-select bus-goods-detail height-large !mt-0 !mb-0 !h-[42px]"
                    formControlName="busScheduleId" nzPlaceHolder="Chọn Bus Schedule" nzSize="large"
                    [nzOptionHeightPx]="80" [nzCustomTemplate]="defaultTemplateSelectBusSchedule"
                    [nzDisabled]="!mainForm.get('busRouteId')?.value">
                    @for (busSchedule of busSchedulesFiltered; track busSchedule) {
                    <nz-option nzCustomContent [nzLabel]="busSchedule.name" [nzValue]="busSchedule._id">
                      <div class="flex flex-col">
                        <span class="flex justify-between w-full">
                          <span>
                            {{ busSchedule.bus?.name || 'Chưa có xe' }}
                          </span>
                          <span>
                            {{ formatTime(busSchedule.startDate) }} - {{ formatDate(busSchedule.startDate) }}
                          </span>
                        </span>
                        <span class="flex justify-end w-full">
                          <span>
                            {{ formatTime(busSchedule.endDate) }} - {{ formatDate(busSchedule.endDate) }}
                          </span>
                        </span>
                      </div>
                    </nz-option>
                    }
                  </nz-select>
                  <ng-template #defaultTemplateSelectBusSchedule let-selected>
                    <div class="flex flex-col" *ngIf="busSchedule">
                      <span class="flex justify-between w-full leading-[26px]">
                        <span>
                          {{ busSchedule.bus?.name || 'Chưa có xe' }}
                        </span>
                      </span>
                      <span class="flex justify-between w-full leading-[26px]">
                        <span>
                          {{ formatTime(busSchedule.startDate) }} - {{ formatDate(busSchedule.startDate) }}
                        </span>
                        <span>
                          {{ formatTime(busSchedule.endDate) }} - {{ formatDate(busSchedule.endDate) }}
                        </span>
                      </span>
                    </div>
                  </ng-template>
                </nz-form-control>
              </div>
            </div>
          </div>
        </div>

        <div class="my-5 flex w-full justify-end">
          <button
            class="!min-w-24 !bg-primary !flex !h-max !justify-center !rounded-lg !py-2 !px-3 !text-white hover:!border-red-500 hover:!bg-red-200 hover:!text-red-500"
            nz-button nzType="default" type="submit">
            SAVE
          </button>
        </div>
      </form>
    </div>
  </div>
</div>